<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‹ä»¶ç³»ç»Ÿ</title>
</head>
<body>
    <div>
        
    </div>
    <script>

        
        // ğŸŒ¹2.äº‹ä»¶ç³»ç»Ÿ
        // onã€offã€onceï¼ˆæ‰§è¡Œä¸€æ¬¡åä¸å†æ‰§è¡Œï¼‰ã€filterï¼ˆè¿‡æ»¤ä¼ å…¥çš„äº‹ä»¶ï¼‰
        class Events {
            constructor(){
                this.events = {}
            }
            // äº‹ä»¶ç›‘å¬
            on (evt, callback, ctx) {
                if (!this.events[ evt ]) {
                this.events[ evt ] = []
                }
                
                this.events[ evt ].push(callback)

                return this
            }
            // å‘å¸ƒäº‹ä»¶
            emit (evt, ...payload) {
                const callbacks = this.events[ evt ]

                if (callbacks) {
                callbacks.forEach((cb) => cb.apply(this, payload))
                }

                return this
            }
            off(evt, handler) {
                // å•¥éƒ½æ²¡ä¼ ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½å–æ¶ˆ
                if (typeof evt === 'undefined') {
                    delete this.events
                } else if (typeof evt === 'string') {
                // åˆ é™¤æŒ‡å®šäº‹ä»¶çš„å›è°ƒ 
                    if (typeof callback === 'function') {
                        this.events[ evt ] = this.events[ evt ].filter((cb) => cb !== callback)
                    } else {
                        // åˆ é™¤æ•´ä¸ªäº‹ä»¶
                        delete this.events[ evt ]
                    }
                }

                return this
            }

            trigger(evt, args) {
            }

            // åªè¿›è¡Œä¸€æ¬¡çš„äº‹ä»¶è®¢é˜…
            once (evt, callback, ctx) {
                const proxyCallback = (...payload) => {
                    callback.apply(ctx, payload)
                    // å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åå°±åˆ é™¤äº‹ä»¶è®¢é˜…
                    this.off(evt, proxyCallback)
                }

                this.on(evt, proxyCallback, ctx)
            }
            

            filter() {

            }
        }
        
        
    </script>
</body>
</html>